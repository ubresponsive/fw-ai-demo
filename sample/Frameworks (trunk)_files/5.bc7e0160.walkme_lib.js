window,window._walkmeWebpackJP&&(window._walkmeWebpackJP=window._walkmeWebpackJP||[]).push([[5],{523:function(t,i,s){"use strict";s.r(i),s.d(i,"AttentionGrabberDataManager",function(){return n});var i=s(188),h=s(24),n=(e.prototype.updateSelection=function(t){this.selectedId=t,this.G()},e.prototype.updateEvent=function(){this.L=(new Date).getTime(),this.G()},e.prototype.updateUnload=function(){this.unload=1,this.G()},e.prototype.init=function(){var t,i,s=this.X.getData(this.$),h=(new Date).getTime(),n=this._.get().Settings,e=parseInt(n.AGDataVersion)||0;s?(this.tt=h,this.sessionCounter=s.sc||1,this.it=this.ht.isDefined(s.v)?s.v:e,this.nt=e>this.it,t=s.st?Math.abs(h-s.st):0,i=void 0,this.rt&&(i=this.rt.getItem(this.X.keysConfig.attentionGrabber.sessionLength.key)),this.at=parseFloat(i||n.AGSL||1440),this.ot=t/6e4>this.at,this.isNewSession=this.ot||this.nt,this.sessionCounter=this.nt?1:this.ot?this.sessionCounter+1:this.sessionCounter,this.it=this.nt?e:s.v,this.selectedId=this.isNewSession?void 0:s.id,this.L=this.isNewSession?h:s.et,this.unload=this.isNewSession?0:s.u,this.eventTimestampDelta=this.L?Math.abs(h-this.L):0):(this.isNewSession=!0,this.tt=h,this.sessionCounter=1,this.it=e,this.L=h,this.unload=0),this.ut=!0,this.G()},e.prototype.G=function(){var t;this.ut&&(t={st:this.tt,sc:this.sessionCounter,v:this.it,id:this.selectedId,et:this.L,u:this.unload},this.X.saveData(this.$,t,this.X.keysConfig.attentionGrabber.data.expiry))},e);function e(t,i,s){this.rt=Object(h.get)(),this.ut=!1,this._=t,this.X=i,this.ht=s,this.$=i.keysConfig.attentionGrabber.data.key}i.register("AttentionGrabberDataManager").asCtor(n).dependencies("SiteConfigManager, ClientStorageManager, CommonUtils")},524:function(t,i,h){"use strict";h.r(i),h.d(i,"AttentionGrabberManager",function(){return s});var n=h(0),e=h(188),s=(r.prototype.init=function(t){var i,s;t.config&&t.player&&(this.ct=t.config,this.ft=t.player,this.bt=t.menu,i=this.ct.Settings.AG,(s=this.ct.Settings.AGs)&&0<s.length?(this.vt.init(),this.gt(s)):i&&this.create(t).setupAttenGrab())},r.prototype.reset=function(){this.dt=this.lt=this.ct=this.ft=this.bt=void 0},r.prototype.blockLoad=function(){this.At=!0},r.prototype.gt=function(t){this.vt.isNewSession?(i=(i=this.Mt(t)).sort(function(t,i){return t.Priority-i.Priority}),this.wt(i)):this.Gt(t),this.dt?(this.Ct.customerLog("Attention grabber - name: "+this.dt.Name+", settings:",3),this.Ct.customerLog(this.dt.Settings,3)):this.Ct.customerLog("Attention grabber: not selected",3);var i="Attention grabber data: session counter = "+this.vt.sessionCounter+", selected AG = "+this.vt.selectedId+", unload AG = "+this.vt.unload+", event timestamp delta = "+this.vt.eventTimestampDelta/1e3+"s, session = "+this.vt.isNewSession;this.Ct.customerLog(i,4)},r.prototype.Mt=function(t){for(var i=[],s=this.vt.sessionCounter,h=0;h<t.length;h++){var n=t[h],e=n.Settings;this.Dt(s,e)&&(parseInt(e.newContent)?this.St.hasNewDeployables()&&(n.Priority-=this.It,i.push(n)):i.push(n))}return i},r.prototype.wt=function(t){for(var i=0;i<t.length;i++){var s=t[i],h=s.Settings;if(!h.conditions)return this.dt=s,void this.vt.updateSelection(s.Id);if(this.Ot.evaluate(h.conditions))return this.dt=s,void this.vt.updateSelection(s.Id)}},r.prototype.Gt=function(t){for(var i=this.vt.sessionCounter,s=0;s<t.length;s++){var h,n=t[s];n.Settings;if(n.Id==this.vt.selectedId)return h=n.Settings,void(this.Dt(i,h)&&this.jt(h)&&(!h.conditions||this.Ot.evaluate(h.conditions)?(this.dt=n,this.vt.updateSelection(n.Id)):this.Ct.customerLog("Attention grabber conditions are not satisfied",5)))}},r.prototype.Dt=function(t,i){return!(!(i&&this.Ut.isDefined(i.session)&&this.Ut.isDefined(i.interval))||t<i.session||t!=i.session&&(0==i.interval||(t-i.session)%i.interval!=0))},r.prototype.jt=function(t){if(this.vt.unload)return!1;if(!t)return!1;var i=this.vt.eventTimestampDelta,s=parseInt(t.replay);if(!s||!i)return!1;s=60*s*1e3;return t.delay=s<i?0:(s-i)/1e3,!0},r.prototype.load=function(s){return Object(n.__awaiter)(this,void 0,void 0,function(){var i;return Object(n.__generator)(this,function(t){switch(t.label){case 0:return!this.dt||this.At?[2]:(i={config:this.ct,player:this.ft,menu:this.bt,agData:this.dt},[4,h.e(4).then(h.bind(null,1433))]);case 1:return t.sent(),this.lt=e.create("AttentionGrabber",i),this.lt.setupAttenGrab(),s&&s(),[2]}})})},r.prototype.remove=function(t){this.lt?(this.vt.updateUnload(),this.lt.remove(t)):t&&t()},r.prototype.create=function(t){return this.ct=t.config,this.ft=t.player,this.lt=e.create("AttentionGrabber",t),this.lt},r.prototype.getImageAG=function(t){return this.ct=t.config,this.ft=t.player,this.lt=e.create("ImageAttentionGrabber",t),this.lt},r);function r(t,i,s,h,n,e){this.Ut=e,this.At=!1,this.It=1e3,this.Ot=t,this.yt=s,this.St=h,this.Ct=n,this.vt=i}e.register("AttentionGrabberManager").asCtor(s).dependencies("ConditionTreeEvaluator, AttentionGrabberDataManager, ClientOrServerStorageManager, PublishDataManager, Logger, CommonUtils, SiteConfigManager, Consts")}}]);